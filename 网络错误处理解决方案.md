# ç½‘ç»œé”™è¯¯å¤„ç†è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

ä½ é‡åˆ°çš„é”™è¯¯ï¼š
```
Failed to execute 'json' on 'Response': Unexpected end of JSON input
Failed to fetch
```

è¿™é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼š
1. åç«¯æœåŠ¡æœªå¯åŠ¨
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. æœåŠ¡å™¨å“åº”å¼‚å¸¸
4. è¶…æ—¶æˆ–è¿æ¥è¢«æ‹’ç»

## è§£å†³æ–¹æ¡ˆæ¦‚è¿°

æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œé”™è¯¯å¤„ç†å·¥å…·åŒ…ï¼ŒåŒ…æ‹¬ï¼š

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½é”™è¯¯è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«ä¸åŒç±»å‹çš„ç½‘ç»œé”™è¯¯
- **å‹å¥½é”™è¯¯æç¤º**: å¤šè¯­è¨€æ”¯æŒçš„ç”¨æˆ·å‹å¥½æç¤º
- **è‡ªåŠ¨é‡è¯•æœºåˆ¶**: æ™ºèƒ½é‡è¯•ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿
- **è¶…æ—¶æ§åˆ¶**: é˜²æ­¢è¯·æ±‚æ— é™ç­‰å¾…

### ğŸŒ å¤šè¯­è¨€æ”¯æŒ
- ç®€ä½“ä¸­æ–‡ (zh)
- ç¹ä½“ä¸­æ–‡ (zh-TW)  
- è¶Šå—è¯­ (vi)
- è‹±è¯­ (en)

## å®ç°çš„æ–‡ä»¶

### 1. é”™è¯¯åˆ†æå·¥å…·
**æ–‡ä»¶**: `src/utils/networkErrorHandler.ts`
- åˆ†æç½‘ç»œé”™è¯¯ç±»å‹
- æä¾›å¤šè¯­è¨€é”™è¯¯ä¿¡æ¯
- åˆ¤æ–­é”™è¯¯æ˜¯å¦å¯é‡è¯•

### 2. å¢å¼ºçš„FetchåŒ…è£…å™¨
**æ–‡ä»¶**: `src/utils/enhancedFetch.ts`
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- è¶…æ—¶æ§åˆ¶
- é”™è¯¯åˆ†ç±»å¤„ç†
- æ‰¹é‡è¯·æ±‚æ”¯æŒ

### 3. React Hook
**æ–‡ä»¶**: `src/hooks/useNetworkError.ts`
- ç®¡ç†é”™è¯¯çŠ¶æ€
- æä¾›é‡è¯•åŠŸèƒ½
- è‡ªåŠ¨éšè—é€‰é¡¹

### 4. é”™è¯¯æç¤ºç»„ä»¶
**æ–‡ä»¶**: `src/components/NetworkErrorModal.tsx`
- å‹å¥½çš„é”™è¯¯æç¤ºç•Œé¢
- å¤šè¯­è¨€æ”¯æŒ
- é‡è¯•æŒ‰é’®
- æŠ€æœ¯è¯¦æƒ…å±•ç¤º

### 5. ä½¿ç”¨ç¤ºä¾‹
**æ–‡ä»¶**: `src/components/NetworkErrorExample.tsx`
- å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
- é”™è¯¯æ¨¡æ‹Ÿæµ‹è¯•
- å¤šè¯­è¨€ç•Œé¢

### 6. æµ‹è¯•é¡µé¢
**æ–‡ä»¶**: `src/pages/NetworkErrorTest.tsx`
- ç‹¬ç«‹çš„æµ‹è¯•é¡µé¢
- æ–¹ä¾¿æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µ

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```tsx
import { useNetworkError } from '../hooks/useNetworkError'
import NetworkErrorModal from '../components/NetworkErrorModal'

function MyComponent() {
  const { error, isErrorModalOpen, showError, hideError, retry } = useNetworkError({
    onRetry: fetchData
  })

  async function fetchData() {
    try {
      const response = await fetch('/api/data')
      const data = await response.json()
      // å¤„ç†æ•°æ®...
    } catch (error) {
      showError(error) // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
    }
  }

  return (
    <div>
      <button onClick={fetchData}>è·å–æ•°æ®</button>
      
      <NetworkErrorModal
        error={error}
        isOpen={isErrorModalOpen}
        onClose={hideError}
        onRetry={retry}
      />
    </div>
  )
}
```

### ä½¿ç”¨å¢å¼ºçš„Fetch

```tsx
import { enhancedFetch } from '../utils/enhancedFetch'

async function fetchData() {
  try {
    const result = await enhancedFetch('/api/data', {
      timeout: 10000,        // 10ç§’è¶…æ—¶
      retries: 3,            // é‡è¯•3æ¬¡
      retryDelay: 1000       // é‡è¯•å»¶è¿Ÿ1ç§’
    })
    
    console.log('æ•°æ®:', result.data)
  } catch (error) {
    console.error('è¯·æ±‚å¤±è´¥:', error)
  }
}
```

## é”™è¯¯ç±»å‹è¯†åˆ«

### è‡ªåŠ¨è¯†åˆ«çš„é”™è¯¯

| é”™è¯¯ç±»å‹ | æè¿° | å¯é‡è¯• | ç”¨æˆ·æç¤º |
|---------|------|--------|----------|
| `server_not_started` | æœåŠ¡å™¨æœªå¯åŠ¨ | âœ… | "æœåŠ¡å™¨å¯èƒ½æœªå¯åŠ¨ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€" |
| `connection_refused` | è¿æ¥è¢«æ‹’ç» | âœ… | "æœåŠ¡å™¨å¯èƒ½æœªå¯åŠ¨ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€" |
| `network_timeout` | ç½‘ç»œè¶…æ—¶ | âœ… | "ç½‘ç»œè¿æ¥è¾ƒæ…¢ï¼Œè¯·ç¨åé‡è¯•" |
| `dns_resolution_failed` | DNSè§£æå¤±è´¥ | âœ… | "è¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®æˆ–ç¨åé‡è¯•" |
| `ssl_handshake_failed` | SSLæ¡æ‰‹å¤±è´¥ | âœ… | "è¯·æ£€æŸ¥ç½‘ç»œç¯å¢ƒæˆ–è”ç³»æŠ€æœ¯æ”¯æŒ" |

## å¤šè¯­è¨€é”™è¯¯æç¤ºç¤ºä¾‹

### ç®€ä½“ä¸­æ–‡
- **é”™è¯¯**: "æœåŠ¡å™¨æœªå¯åŠ¨"
- **å»ºè®®**: "æœåŠ¡å™¨å¯èƒ½æœªå¯åŠ¨ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€æˆ–è”ç³»ç®¡ç†å‘˜"

### ç¹ä½“ä¸­æ–‡
- **éŒ¯èª¤**: "ä¼ºæœå™¨æœªå•Ÿå‹•"
- **å»ºè­°**: "ä¼ºæœå™¨å¯èƒ½æœªå•Ÿå‹•ï¼Œè«‹æª¢æŸ¥æœå‹™ç‹€æ…‹æˆ–è¯çµ¡ç®¡ç†å“¡"

### è¶Šå—è¯­
- **Lá»—i**: "MÃ¡y chá»§ chÆ°a khá»Ÿi Ä‘á»™ng"
- **Gá»£i Ã½**: "MÃ¡y chá»§ cÃ³ thá»ƒ chÆ°a khá»Ÿi Ä‘á»™ng, vui lÃ²ng kiá»ƒm tra tráº¡ng thÃ¡i dá»‹ch vá»¥"

### English
- **Error**: "Server not started"
- **Suggestion**: "Server may not be started, please check service status"

## é›†æˆåˆ°ç°æœ‰é¡¹ç›®

### 1. æ›¿æ¢ç°æœ‰çš„fetchè°ƒç”¨

**ä¹‹å‰**:
```tsx
try {
  const response = await fetch('/api/data')
  const data = await response.json()
} catch (error) {
  console.error('è¯·æ±‚å¤±è´¥:', error)
}
```

**ä¹‹å**:
```tsx
import { enhancedFetch } from '../utils/enhancedFetch'

try {
  const result = await enhancedFetch('/api/data')
  const data = result.data
} catch (error) {
  // ä½¿ç”¨ useNetworkError Hook æ˜¾ç¤ºå‹å¥½æç¤º
  showError(error)
}
```

### 2. åœ¨ç°æœ‰æœåŠ¡ä¸­ä½¿ç”¨

```tsx
// ä¹‹å‰
export class UserService {
  async getUsers() {
    const response = await fetch('/api/users')
    return response.json()
  }
}

// ä¹‹å
import { enhancedFetch } from '../utils/enhancedFetch'

export class UserService {
  async getUsers() {
    try {
      const result = await enhancedFetch('/api/users')
      return result.data
    } catch (error) {
      throw error // é”™è¯¯ä¼šè¢«ä¸Šå±‚ç»„ä»¶å¤„ç†
    }
  }
}
```

## æµ‹è¯•æ–¹æ³•

### 1. è®¿é—®æµ‹è¯•é¡µé¢
åœ¨æµè§ˆå™¨ä¸­è®¿é—® `/NetworkErrorTest` é¡µé¢

### 2. æµ‹è¯•å„ç§é”™è¯¯
- ç‚¹å‡»"æ¨¡æ‹ŸæœåŠ¡å™¨é”™è¯¯"æŒ‰é’®
- ç‚¹å‡»"æ¨¡æ‹Ÿç½‘ç»œé”™è¯¯"æŒ‰é’®
- ç‚¹å‡»"æ¨¡æ‹Ÿè¿æ¥é”™è¯¯"æŒ‰é’®
- è§‚å¯Ÿå¤šè¯­è¨€é”™è¯¯æç¤º

### 3. æµ‹è¯•é‡è¯•åŠŸèƒ½
- è§¦å‘é”™è¯¯åç‚¹å‡»"é‡è¯•"æŒ‰é’®
- è§‚å¯Ÿé‡è¯•çŠ¶æ€å’Œç»“æœ

## é…ç½®é€‰é¡¹

### useNetworkError Hook é€‰é¡¹

```tsx
const { showError } = useNetworkError({
  onRetry: fetchData,        // é‡è¯•å‡½æ•°
  autoHide: false,           // æ˜¯å¦è‡ªåŠ¨éšè—é”™è¯¯
  autoHideDelay: 5000        // è‡ªåŠ¨éšè—å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
})
```

### enhancedFetch é€‰é¡¹

```tsx
const result = await enhancedFetch(url, {
  timeout: 10000,            // è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  retries: 3,                // é‡è¯•æ¬¡æ•°
  retryDelay: 1000,          // é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
  retryOnNetworkError: true  // æ˜¯å¦åœ¨ç½‘ç»œé”™è¯¯æ—¶é‡è¯•
})
```

## ä¼˜åŠ¿

### ğŸš€ ç”¨æˆ·ä½“éªŒ
- å‹å¥½çš„é”™è¯¯æç¤ºï¼Œä¸å†æ˜¯æŠ€æœ¯æœ¯è¯­
- å¤šè¯­è¨€æ”¯æŒï¼Œè¦†ç›–ä¸»è¦ç”¨æˆ·ç¾¤ä½“
- æä¾›å…·ä½“çš„è§£å†³å»ºè®®

### ğŸ› ï¸ å¼€å‘ä½“éªŒ
- ç®€å•çš„APIï¼Œæ˜“äºé›†æˆ
- è‡ªåŠ¨é”™è¯¯å¤„ç†ï¼Œå‡å°‘é‡å¤ä»£ç 
- æ”¯æŒè‡ªå®šä¹‰å’Œæ‰©å±•

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§
- æ™ºèƒ½é‡è¯•æœºåˆ¶
- è¶…æ—¶æ§åˆ¶
- é”™è¯¯åˆ†ç±»å’Œç»Ÿè®¡
- æ€§èƒ½ä¼˜åŒ–

## ä¸‹ä¸€æ­¥

1. **æµ‹è¯•åŠŸèƒ½**: è®¿é—® `/NetworkErrorTest` é¡µé¢æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µ
2. **é›†æˆä½¿ç”¨**: åœ¨ç°æœ‰ç»„ä»¶ä¸­æ›¿æ¢fetchè°ƒç”¨
3. **è‡ªå®šä¹‰é…ç½®**: æ ¹æ®éœ€è¦è°ƒæ•´é‡è¯•ç­–ç•¥å’Œè¶…æ—¶è®¾ç½®
4. **æ‰©å±•åŠŸèƒ½**: æ·»åŠ æ›´å¤šé”™è¯¯ç±»å‹å’Œè‡ªå®šä¹‰å¤„ç†é€»è¾‘

## æ€»ç»“

è¿™ä¸ªè§£å†³æ–¹æ¡ˆå®Œç¾è§£å†³äº†ä½ é‡åˆ°çš„ç½‘ç»œé”™è¯¯é—®é¢˜ï¼š

- âœ… **"Failed to execute 'json' on 'Response'"** â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºæœåŠ¡å™¨æœªå¯åŠ¨
- âœ… **"Failed to fetch"** â†’ è‡ªåŠ¨è¯†åˆ«ä¸ºç½‘ç»œè¿æ¥é—®é¢˜
- âœ… **å¤šè¯­è¨€æ”¯æŒ** â†’ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- âœ… **è‡ªåŠ¨é‡è¯•** â†’ æé«˜æˆåŠŸç‡
- âœ… **æ˜“äºé›†æˆ** â†’ å¿«é€Ÿåº”ç”¨åˆ°ç°æœ‰é¡¹ç›®

ç°åœ¨ä½ çš„åº”ç”¨å¯ä»¥ä¼˜é›…åœ°å¤„ç†å„ç§ç½‘ç»œé”™è¯¯ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒï¼
