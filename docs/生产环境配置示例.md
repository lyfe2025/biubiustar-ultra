# 🚀 生产环境配置示例

## 📋 快速配置切换

### 开发环境 → 生产环境

只需要修改 `.env` 文件中的关键配置项即可：

```bash
# 1. 环境配置
NODE_ENV=production                    # 开发环境：development，生产环境：production
PORT=3000                              # 开发环境：3001，生产环境：3000 或使用反向代理
FRONTEND_URL=https://yourdomain.com    # 开发环境：localhost，生产环境：https://yourdomain.com

# 2. 安全配置 (必须修改)
JWT_SECRET=your-production-jwt-secret-here    # 生产环境必须生成强密钥：openssl rand -hex 32
SESSION_SECRET=your-production-session-secret-here    # 生产环境必须生成强密钥：openssl rand -hex 32
CORS_ORIGIN=https://yourdomain.com    # 开发环境：localhost，生产环境：https://yourdomain.com

# 3. 性能配置
ENABLE_CACHE_LOGGING=false             # 开发环境：true，生产环境：false (减少日志)
LOG_LEVEL=info                         # 开发环境：debug，生产环境：info 或 warn
CACHE_MONITOR_VERBOSE=false            # 开发环境：true，生产环境：false (减少日志)

# 4. 开发功能 (必须禁用)
DEBUG=false                             # 开发环境：true，生产环境：false (安全要求)
HOT_RELOAD=false                       # 开发环境：true，生产环境：false (性能要求)
CACHE_INVALIDATION_TEST_ENABLED=false  # 开发环境：true，生产环境：false (安全要求)

# 5. 缓存配置 (通过管理后台动态调整)
# 建议生产环境配置：
# CACHE_USER_MAX_SIZE=2000        # 生产环境：2000项
# CACHE_CONTENT_MAX_SIZE=5000     # 生产环境：5000项
# CACHE_STATS_MAX_SIZE=1000       # 生产环境：1000项
# CACHE_CONFIG_MAX_SIZE=500       # 生产环境：500项
# CACHE_SESSION_MAX_SIZE=2000     # 生产环境：2000项
# CACHE_API_MAX_SIZE=2000         # 生产环境：2000项

# 6. 文件上传配置
UPLOAD_MAX_SIZE=104857600          # 开发环境：50MB，生产环境：100MB (根据服务器性能)
RATE_LIMIT_MAX_REQUESTS=50         # 开发环境：100次，生产环境：50次 (更严格)
```

## 🔑 密钥生成命令

### 生成强密钥
```bash
# JWT密钥
openssl rand -hex 32

# 会话密钥
openssl rand -hex 32

# 示例输出
# 8f7d3b2a1e9c4f6d8a2b5e9c4f6d8a2b5e9c4f6d8a2b5e9c4f6d8a2b5e9c4
```

## 📱 配置管理方式

### 1. 管理后台配置 (推荐)
```bash
# 访问地址
http://yourdomain.com/admin/settings/cache

# 功能
- 实时调整缓存参数
- 监控缓存性能
- 查看系统状态
```

### 2. API接口配置
```bash
# 更新缓存配置
PUT /api/admin/settings/cache
{
  "cacheType": "user",
  "maxSize": 2000,
  "defaultTTL": 1800000,
  "cleanupInterval": 600000
}
```

## 🚨 生产环境部署检查清单

### ✅ 环境配置
- [ ] `NODE_ENV=production`
- [ ] `PORT=3000` (或使用反向代理)
- [ ] `FRONTEND_URL=https://yourdomain.com`

### ✅ 安全配置
- [ ] 生成并设置强 `JWT_SECRET`
- [ ] 生成并设置强 `SESSION_SECRET`
- [ ] 限制 `CORS_ORIGIN` 只包含实际域名
- [ ] 调整 `RATE_LIMIT_MAX_REQUESTS` 为更严格的值

### ✅ 性能配置
- [ ] 禁用 `DEBUG` 和 `HOT_RELOAD`
- [ ] 设置 `LOG_LEVEL=info`
- [ ] 禁用 `CACHE_MONITOR_VERBOSE`
- [ ] 通过管理后台优化缓存参数

### ✅ 监控配置
- [ ] 启用 `PERFORMANCE_MONITOR_ENABLED`
- [ ] 配置错误监控和告警
- [ ] 设置日志轮转

## 🔄 一键切换脚本

### 开发环境切换脚本
```bash
#!/bin/bash
# scripts/switch-to-dev.sh

echo "切换到开发环境..."

# 备份当前配置
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# 修改关键配置
sed -i 's/NODE_ENV=production/NODE_ENV=development/' .env
sed -i 's/PORT=3000/PORT=3001/' .env
sed -i 's/FRONTEND_URL=https:\/\/yourdomain.com/FRONTEND_URL=http:\/\/localhost:5173/' .env
sed -i 's/LOG_LEVEL=info/LOG_LEVEL=debug/' .env
sed -i 's/DEBUG=false/DEBUG=true/' .env

echo "已切换到开发环境配置"
echo "请重启服务使配置生效"
```

### 生产环境切换脚本
```bash
#!/bin/bash
# scripts/switch-to-prod.sh

echo "切换到生产环境..."

# 备份当前配置
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# 修改关键配置
sed -i 's/NODE_ENV=development/NODE_ENV=production/' .env
sed -i 's/PORT=3001/PORT=3000/' .env
sed -i 's/FRONTEND_URL=http:\/\/localhost:5173/FRONTEND_URL=https:\/\/yourdomain.com/' .env
sed -i 's/LOG_LEVEL=debug/LOG_LEVEL=info/' .env
sed -i 's/DEBUG=true/DEBUG=false/' .env

echo "已切换到生产环境配置"
echo "请重启服务使配置生效"
echo "注意：生产环境必须手动设置强密钥！"
```

## 📊 性能指标参考

### 缓存性能目标
- **缓存命中率**: > 85%
- **平均响应时间**: < 100ms
- **内存使用率**: < 70%

### 系统性能目标
- **API响应时间**: < 200ms
- **并发用户数**: 根据服务器配置
- **系统可用性**: > 99.9%

## 🎯 总结

通过在每个配置项旁边添加生产环境建议，现在你可以：

1. **快速识别**: 哪些配置需要为生产环境调整
2. **一键切换**: 使用脚本快速切换环境配置
3. **安全部署**: 确保生产环境的安全配置
4. **性能优化**: 根据建议优化缓存和系统性能

记住：生产环境部署前必须完成安全检查清单中的所有项目！🚀
