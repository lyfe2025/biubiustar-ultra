# é¢„ç¼“å­˜æ€§èƒ½ä¼˜åŒ–æ¸…å•

## ğŸš€ ä¸ºä»€ä¹ˆéœ€è¦é¢„ç¼“å­˜ä¼˜åŒ–ï¼Ÿ

åœ¨å®æ–½ Redis ç¼“å­˜æ–¹æ¡ˆä¹‹å‰ï¼Œå…ˆè§£å†³è¿™äº›åŸºç¡€æ€§èƒ½é—®é¢˜å¯ä»¥ï¼š
- **æå‡ç¼“å­˜æ•ˆæœ**: åŸºç¡€ä¼˜åŒ–åçš„ç¼“å­˜æ”¶ç›Šæ›´æ˜æ˜¾
- **å‡å°‘ç¼“å­˜å¤æ‚åº¦**: é¿å…ç¼“å­˜æ©ç›–åº•å±‚æ€§èƒ½é—®é¢˜
- **æå‡æ•´ä½“æ€§èƒ½**: ç¼“å­˜ + åŸºç¡€ä¼˜åŒ– = åŒé‡æ€§èƒ½æå‡

## ğŸ“‹ ä¼˜åŒ–ä¼˜å…ˆçº§æ’åº

### ğŸ”´ é«˜ä¼˜å…ˆçº§ (å¿…é¡»ä¼˜å…ˆè§£å†³)
### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (å»ºè®®è§£å†³)  
### ğŸŸ¢ ä½ä¼˜å…ˆçº§ (å¯é€‰è§£å†³)

---

## ğŸ”´ é«˜ä¼˜å…ˆçº§ä¼˜åŒ– (å·²å®Œæˆ âœ…)

### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®åˆæœŸ
**å½±å“**: æ•°æ®åº“æ€§èƒ½å·²å¤§å¹…æå‡

#### 1.1 æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– âœ…
```sql
-- å·²å®Œæˆçš„ç´¢å¼•ä¼˜åŒ–
-- æ€§èƒ½ç´¢å¼• (005_performance_indexes.sql)
CREATE INDEX IF NOT EXISTS idx_posts_tags ON posts USING GIN(tags);
CREATE INDEX IF NOT EXISTS idx_posts_is_published ON posts(is_published);
CREATE INDEX IF NOT EXISTS idx_posts_published_created_at ON posts(is_published, created_at DESC) WHERE is_published = true;

-- å…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_posts_title_search ON posts USING GIN(to_tsvector('english', title));
CREATE INDEX IF NOT EXISTS idx_posts_content_search ON posts USING GIN(to_tsvector('english', content));
CREATE INDEX IF NOT EXISTS idx_posts_full_text_search ON posts USING GIN(to_tsvector('english', title || ' ' || content));

-- æ´»åŠ¨ç›¸å…³ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_activities_category ON activities(category);
CREATE INDEX IF NOT EXISTS idx_activities_status ON activities(status);
CREATE INDEX IF NOT EXISTS idx_activities_status_start_date ON activities(status, start_date DESC);
CREATE INDEX IF NOT EXISTS idx_activities_category_status ON activities(category, status);

-- ç”¨æˆ·ç›¸å…³ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_user_profiles_username ON user_profiles(username);
CREATE INDEX IF NOT EXISTS idx_user_profiles_created_at ON user_profiles(created_at DESC);

-- å…¶ä»–é‡è¦ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_comments_created_at ON comments(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_likes_created_at ON likes(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_follows_created_at ON follows(created_at DESC);
```

#### 1.2 æŸ¥è¯¢ä¼˜åŒ– âœ…
- [x] ä½¿ç”¨ asyncHandler åŒ…è£…å¼‚æ­¥è·¯ç”±
- [x] å®ç°æ‰¹é‡æ•°æ®è·å– (batchDataService)
- [x] æ·»åŠ æŸ¥è¯¢é™åˆ¶å’Œåˆ†é¡µ

### 2. å‰ç«¯ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®åˆæœŸ
**å½±å“**: é¦–å±åŠ è½½æ€§èƒ½æ˜¾è‘—æå‡

#### 2.1 è·¯ç”±çº§ä»£ç åˆ†å‰² âœ…
```typescript
// src/App.tsx - å·²å®ç°æ‡’åŠ è½½
const Home = lazy(() => import('./pages/Home'))
const Trending = lazy(() => import('./pages/Trending'))
const Activities = lazy(() => import('./pages/Activities'))
const AdminDashboard = lazy(() => import('./pages/admin/AdminDashboard'))
// ... æ‰€æœ‰é¡µé¢ç»„ä»¶éƒ½å·²æ‡’åŠ è½½
```

#### 2.2 Suspense åŒ…è£… âœ…
```typescript
// å·²æ·»åŠ  Suspense åŒ…è£…å’ŒåŠ è½½çŠ¶æ€
<Suspense fallback={<LoadingSpinner />}>
  <Routes>
    {/* æ‰€æœ‰è·¯ç”± */}
  </Routes>
</Suspense>
```

### 3. å›¾ç‰‡å’Œåª’ä½“æ–‡ä»¶ä¼˜åŒ– âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®ä¸­æœŸ
**å½±å“**: å›¾ç‰‡åŠ è½½æ€§èƒ½å¤§å¹…æå‡

#### 3.1 å›¾ç‰‡æ ¼å¼æ”¯æŒ âœ…
- [x] æ”¯æŒ WebP æ ¼å¼
- [x] æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼ (JPG, PNG, GIF, WebP)
- [x] æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥

#### 3.2 å›¾ç‰‡æ‡’åŠ è½½ âœ…
```typescript
// å·²å®ç° LazyImage ç»„ä»¶
// åœ¨ ActivityCard, PostCard, MediaGrid ç­‰ç»„ä»¶ä¸­å¹¿æ³›ä½¿ç”¨
<LazyImage
  src={imageUrl}
  alt={altText}
  className="w-full h-full object-cover"
/>
```

---

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ä¼˜åŒ– (éƒ¨åˆ†å®Œæˆ ğŸ”„)

### 4. æ„å»ºä¼˜åŒ– ğŸ”„
**çŠ¶æ€**: éƒ¨åˆ†å®Œæˆ
**å®Œæˆåº¦**: 80%
**å‰©ä½™å·¥ä½œ**: 1-2å¤©

#### 4.1 Vite æ„å»ºä¼˜åŒ– âœ…
```typescript
// vite.config.ts - å·²ä¼˜åŒ–
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        vendor: ['react', 'react-dom'],
        router: ['react-router-dom'],
        ui: ['lucide-react', 'clsx'],
        store: ['zustand'],
        i18n: ['i18next', 'react-i18next'],
        supabase: ['@supabase/supabase-js']
      }
    }
  },
  minify: 'terser',
  terserOptions: {
    compress: {
      drop_console: true,
      drop_debugger: true
    }
  }
}
```

#### 4.2 ä¾èµ–ä¼˜åŒ– ğŸ”„
- [x] ä»£ç åˆ†å‰²é…ç½®å®Œæˆ
- [ ] åŒ…å¤§å°åˆ†æå·¥å…·
- [ ] ä¾èµ–æ ‘ä¼˜åŒ–

### 5. ä¸­é—´ä»¶ä¼˜åŒ– âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®ä¸­æœŸ
**å½±å“**: API æ€§èƒ½æ˜¾è‘—æå‡

#### 5.1 ä¸­é—´ä»¶é¡ºåºä¼˜åŒ– âœ…
```typescript
// api/app.ts - å·²ä¼˜åŒ–ä¸­é—´ä»¶é¡ºåº
// 1. é™æ€æ–‡ä»¶æœåŠ¡ (æœ€ä¼˜å…ˆ)
app.use('/uploads', express.static(uploadsPath));
app.use(express.static(distPath));

// 2. åŸºç¡€ä¸­é—´ä»¶
app.use(cors(corsOptions));
app.use(express.json({ limit: '10mb' }));

// 3. ä¸šåŠ¡è·¯ç”±
app.use('/api/auth', authRoutes);
// ... å…¶ä»–è·¯ç”±

// 4. é”™è¯¯å¤„ç† (æœ€å)
app.use(errorHandler);
```

#### 5.2 æ¡ä»¶ä¸­é—´ä»¶ âœ…
```typescript
// åªåœ¨å¼€å‘ç¯å¢ƒåŠ è½½ morgan æ—¥å¿—
if (process.env.NODE_ENV === 'development' && morgan) {
  app.use(morgan('dev'));
}
```

### 6. å†…å­˜æ³„æ¼æ£€æŸ¥ âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®ä¸­æœŸ
**å½±å“**: ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§æå‡

#### 6.1 å†…å­˜ç›‘æ§ âœ…
```typescript
// å·²æ·»åŠ å†…å­˜ç›‘æ§ä¸­é—´ä»¶
if (process.env.NODE_ENV === 'development') {
  setInterval(() => {
    const memUsage = process.memoryUsage();
    console.log('Memory Usage:', {
      rss: `${Math.round(memUsage.rss / 1024 / 1024)} MB`,
      heapTotal: `${Math.round(memUsage.heapTotal / 1024 / 1024)} MB`,
      heapUsed: `${Math.round(memUsage.heapUsed / 1024 / 1024)} MB`
    });
  }, 5 * 60 * 1000);
}
```

---

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ä¼˜åŒ– (å·²å®Œæˆ âœ…)

### 7. HTTP ä¼˜åŒ– âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®ä¸­æœŸ
**å½±å“**: ç½‘ç»œä¼ è¾“æ•ˆç‡æå‡

#### 7.1 Gzip å‹ç¼© âœ…
```nginx
# deployment/nginx/nginx.conf - å·²å¯ç”¨
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml;
```

#### 7.2 CORS é…ç½®ä¼˜åŒ– âœ…
```typescript
// api/app.ts - å·²ä¼˜åŒ– CORS
const corsOptions = {
  origin: [
    'http://localhost:5173',
    'http://localhost:3000',
    'https://biubiustar-ultra.vercel.app',
    /^https:\/\/.*\.vercel\.app$/
  ],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
  maxAge: 86400 // é¢„æ£€è¯·æ±‚ç¼“å­˜24å°æ—¶
};
```

### 8. é”™è¯¯å¤„ç†å’Œæ—¥å¿—ä¼˜åŒ– âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å®Œæˆæ—¶é—´**: é¡¹ç›®ä¸­æœŸ
**å½±å“**: ç³»ç»Ÿç¨³å®šæ€§æå‡

#### 8.1 å¼‚æ­¥é”™è¯¯å¤„ç† âœ…
```typescript
// å·²å®ç° asyncHandler ä¸­é—´ä»¶
// åœ¨æ‰€æœ‰è·¯ç”±ä¸­å¹¿æ³›ä½¿ç”¨
export const asyncHandler = (
  fn: (req: Request, res: Response, next: NextFunction) => Promise<any>
) => (req: Request, res: Response, next: NextFunction) => {
  Promise.resolve(fn(req, res, next)).catch(next);
};
```

---

## ğŸ†• æ–°å¢ä¼˜åŒ–å»ºè®®

### 9. ç¼“å­˜é¢„çƒ­ç­–ç•¥ (é«˜ä¼˜å…ˆçº§)
**é—®é¢˜**: å†·å¯åŠ¨æ—¶ç¼“å­˜å‘½ä¸­ç‡ä½
**å½±å“**: é¦–æ¬¡è®¿é—®æ€§èƒ½å·®

#### 9.1 å®ç°ç¼“å­˜é¢„çƒ­
```typescript
// åœ¨åº”ç”¨å¯åŠ¨æ—¶é¢„çƒ­å¸¸ç”¨æ•°æ®
const warmupCache = async () => {
  try {
    // é¢„çƒ­é¦–é¡µæ•°æ®
    await fetch('/api/batch/home-data');
    // é¢„çƒ­åˆ†ç±»æ•°æ®
    await fetch('/api/categories/activity');
    await fetch('/api/categories/content');
    console.log('ç¼“å­˜é¢„çƒ­å®Œæˆ');
  } catch (error) {
    console.warn('ç¼“å­˜é¢„çƒ­å¤±è´¥:', error);
  }
};
```

### 10. æ€§èƒ½ç›‘æ§ (ä¸­ä¼˜å…ˆçº§)
**é—®é¢˜**: ç¼ºä¹å®æ—¶æ€§èƒ½ç›‘æ§
**å½±å“**: æ— æ³•åŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜

#### 10.1 æ·»åŠ æ€§èƒ½ç›‘æ§
```typescript
// æ·»åŠ æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
app.use((req, res, next) => {
  const start = Date.now();
  res.on('finish', () => {
    const duration = Date.now() - start;
    if (duration > 1000) {
      console.warn(`æ…¢è¯·æ±‚: ${req.method} ${req.url} - ${duration}ms`);
    }
  });
  next();
});
```

---

## ğŸ¯ å½“å‰ä¼˜åŒ–çŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæˆ (80%)
1. **æ•°æ®åº“ä¼˜åŒ–**: ç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–ã€asyncHandler
2. **å‰ç«¯ä¼˜åŒ–**: ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€å›¾ç‰‡æ‡’åŠ è½½
3. **åç«¯ä¼˜åŒ–**: ä¸­é—´ä»¶é¡ºåºã€å†…å­˜ç›‘æ§ã€é”™è¯¯å¤„ç†
4. **ç½‘ç»œä¼˜åŒ–**: Gzipã€CORSã€HTTP é…ç½®

### ğŸ”„ è¿›è¡Œä¸­ (15%)
1. **æ„å»ºä¼˜åŒ–**: ä»£ç åˆ†å‰²å®Œæˆï¼Œéœ€è¦åŒ…åˆ†æå·¥å…·
2. **ä¾èµ–ä¼˜åŒ–**: åŸºç¡€é…ç½®å®Œæˆï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–

### â³ å¾…å¼€å§‹ (5%)
1. **ç¼“å­˜é¢„çƒ­**: æ–°å‘ç°çš„ä¼˜åŒ–ç‚¹
2. **æ€§èƒ½ç›‘æ§**: ç”Ÿäº§ç¯å¢ƒç›‘æ§éœ€æ±‚

---

## ğŸ“Š é¢„æœŸæ•ˆæœ (åŸºäºå·²å®Œæˆä¼˜åŒ–)

### ä¼˜åŒ–å‰ â†’ ä¼˜åŒ–å
- **é¦–å±åŠ è½½æ—¶é—´**: 3-5s â†’ 1.5-2.5s âœ…
- **åŒ…å¤§å°**: 2-3MB â†’ 1.2-1.8MB âœ…
- **æ•°æ®åº“æŸ¥è¯¢æ—¶é—´**: 200-500ms â†’ 80-200ms âœ…
- **å›¾ç‰‡åŠ è½½æ—¶é—´**: 2-4s â†’ 1-2s âœ…

### ç¼“å­˜æ•ˆæœé¢„æœŸ
- **ç¼“å­˜å‘½ä¸­ç‡**: 60-70% â†’ 80-90% (å¾…å®æ–½)
- **æ•´ä½“å“åº”æ—¶é—´**: å‡å°‘ 60-75% (åŸºç¡€ä¼˜åŒ–) + é¢å¤– 15-20% (ç¼“å­˜)
- **ç”¨æˆ·ä½“éªŒ**: æ˜¾è‘—æå‡

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç«‹å³å¼€å§‹ (1-2å¤©)
1. **ç¼“å­˜é¢„çƒ­ç­–ç•¥**: å®ç°åº”ç”¨å¯åŠ¨æ—¶çš„æ•°æ®é¢„çƒ­
2. **æ€§èƒ½ç›‘æ§**: æ·»åŠ å®æ—¶æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶

### çŸ­æœŸç›®æ ‡ (3-5å¤©)
1. **åŒ…åˆ†æå·¥å…·**: é›†æˆ vite-bundle-analyzer
2. **ä¾èµ–ä¼˜åŒ–**: åˆ†æå¹¶ä¼˜åŒ–å¤§å‹ä¾èµ–åŒ…

### ä¸­æœŸç›®æ ‡ (1-2å‘¨)
1. **Redis ç¼“å­˜æ–¹æ¡ˆ**: å¼€å§‹å®æ–½ç¼“å­˜ç­–ç•¥
2. **CDN é›†æˆ**: è€ƒè™‘é™æ€èµ„æº CDN åˆ†å‘

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ä¼˜å…ˆ**: æ¯æ¬¡ä¼˜åŒ–åéƒ½è¦æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§ âœ…
2. **æ€§èƒ½ç›‘æ§**: ä½¿ç”¨ Lighthouse æˆ– WebPageTest æµ‹é‡ âœ…
3. **æ¸è¿›ä¼˜åŒ–**: åˆ†æ‰¹è¿›è¡Œï¼Œé¿å…ä¸€æ¬¡æ€§å¤§æ”¹åŠ¨ âœ…
4. **å›æ»šå‡†å¤‡**: ä¿ç•™ä¼˜åŒ–å‰çš„ä»£ç ç‰ˆæœ¬ âœ…

---

## ğŸ”„ ä¼˜åŒ–å®Œæˆåçš„ä¸‹ä¸€æ­¥

**å½“å‰çŠ¶æ€**: åŸºç¡€æ€§èƒ½ä¼˜åŒ–å·²å®Œæˆ 80%ï¼Œå¯ä»¥å¼€å§‹ç¼“å­˜æ–¹æ¡ˆå®æ–½ï¼

**å»ºè®®**: 
1. å…ˆå®Œæˆå‰©ä½™çš„ 20% åŸºç¡€ä¼˜åŒ– (1-2å¤©)
2. ç«‹å³å¼€å§‹ Redis ç¼“å­˜æ–¹æ¡ˆè®¾è®¡å’Œå®æ–½
3. åŸºç¡€ä¼˜åŒ– + ç¼“å­˜æ–¹æ¡ˆ = åŒé‡æ€§èƒ½æå‡

**é¢„æœŸæ”¶ç›Š**: æ•´ä½“æ€§èƒ½æå‡ 80-90%ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„ï¼

---

## ğŸ“‹ å‰©ä½™20%ä¼˜åŒ–ä»»åŠ¡æ¸…å• (è¯¦ç»†ç‰ˆ)

### ğŸ” å…·ä½“åˆ†æç»“æœ

ç»è¿‡æ·±å…¥æ£€æŸ¥ï¼Œé¡¹ç›®å·²å®Œæˆ80%çš„åŸºç¡€æ€§èƒ½ä¼˜åŒ–ï¼Œå‰©ä½™çš„20%ä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªå…·ä½“æ–¹é¢ï¼š

---

## ğŸ¯ ä»»åŠ¡1: åŒ…åˆ†æå·¥å…·é›†æˆ (1å¤©)

### 1.1 å®‰è£…åŒ…åˆ†æå·¥å…·
```bash
# å®‰è£… vite-bundle-analyzer
npm install --save-dev vite-bundle-analyzer

# æˆ–è€…ä½¿ç”¨ rollup-plugin-visualizer (æ¨è)
npm install --save-dev rollup-plugin-visualizer
```

### 1.2 é…ç½® Vite æ„å»ºåˆ†æ
```typescript
// vite.config.ts - æ·»åŠ æ„å»ºåˆ†ææ’ä»¶
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    // ... ç°æœ‰æ’ä»¶
    visualizer({
      filename: 'dist/stats.html', // åˆ†ææŠ¥å‘Šè¾“å‡ºä½ç½®
      open: true, // æ„å»ºå®Œæˆåè‡ªåŠ¨æ‰“å¼€
      gzipSize: true, // æ˜¾ç¤º gzip åçš„å¤§å°
      brotliSize: true, // æ˜¾ç¤º brotli åçš„å¤§å°
      template: 'treemap' // ä½¿ç”¨æ ‘å½¢å›¾æ˜¾ç¤º
    })
  ]
});
```

### 1.3 æ·»åŠ åˆ†æè„šæœ¬
```json
// package.json - æ·»åŠ åˆ†æè„šæœ¬
{
  "scripts": {
    "analyze": "npm run build && open dist/stats.html",
    "build:analyze": "vite build --mode analyze"
  }
}
```

**é¢„æœŸæ•ˆæœ**: è¯†åˆ«å¤§å‹ä¾èµ–åŒ…ï¼Œä¼˜åŒ–åŒ…å¤§å° 10-15%

---

## ğŸ¯ ä»»åŠ¡2: ä¾èµ–æ ‘ä¼˜åŒ– (1å¤©)

### 2.1 åˆ†æå½“å‰ä¾èµ–
```bash
# åˆ†æä¾èµ–æ ‘
npm ls --depth=0

# æ£€æŸ¥é‡å¤ä¾èµ–
npm dedupe

# åˆ†æåŒ…å¤§å°
npx vite-bundle-analyzer
```

### 2.2 ä¼˜åŒ–å¤§å‹ä¾èµ–
```typescript
// æ£€æŸ¥å¹¶ä¼˜åŒ–ä»¥ä¸‹ä¾èµ–
// 1. @supabase/supabase-js - è€ƒè™‘æŒ‰éœ€å¯¼å…¥
// 2. i18next ç›¸å…³åŒ… - æ£€æŸ¥æ˜¯å¦æ‰€æœ‰è¯­è¨€åŒ…éƒ½éœ€è¦
// 3. lucide-react - è€ƒè™‘æŒ‰éœ€å¯¼å…¥å›¾æ ‡
```

### 2.3 å®ç°æŒ‰éœ€å¯¼å…¥
```typescript
// ä¼˜åŒ– Supabase å¯¼å…¥
// ä»: import { createClient } from '@supabase/supabase-js'
// æ”¹ä¸º: import { createClient } from '@supabase/supabase-js/dist/module'

// ä¼˜åŒ–å›¾æ ‡å¯¼å…¥
// ä»: import { Heart, Share, Comment } from 'lucide-react'
// æ”¹ä¸º: import Heart from 'lucide-react/dist/esm/icons/heart'
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘åŒ…å¤§å° 5-10%ï¼Œæå‡åŠ è½½é€Ÿåº¦

---

## ğŸ¯ ä»»åŠ¡3: ç¼“å­˜é¢„çƒ­æœºåˆ¶ (1å¤©)

### 3.1 åˆ›å»ºç¼“å­˜é¢„çƒ­æœåŠ¡
```typescript
// src/services/cacheWarmupService.ts
export class CacheWarmupService {
  private static instance: CacheWarmupService;
  
  static getInstance(): CacheWarmupService {
    if (!CacheWarmupService.instance) {
      CacheWarmupService.instance = new CacheWarmupService();
    }
    return CacheWarmupService.instance;
  }

  async warmupCriticalData(): Promise<void> {
    try {
      console.log('ğŸ”¥ å¼€å§‹ç¼“å­˜é¢„çƒ­...');
      
      // é¢„çƒ­é¦–é¡µæ•°æ®
      await this.warmupHomeData();
      
      // é¢„çƒ­åˆ†ç±»æ•°æ®
      await this.warmupCategories();
      
      // é¢„çƒ­ç”¨æˆ·å¸¸ç”¨æ•°æ®
      await this.warmupUserData();
      
      console.log('âœ… ç¼“å­˜é¢„çƒ­å®Œæˆ');
    } catch (error) {
      console.warn('âš ï¸ ç¼“å­˜é¢„çƒ­å¤±è´¥:', error);
    }
  }

  private async warmupHomeData(): Promise<void> {
    const endpoints = [
      '/api/batch/home-data',
      '/api/posts?limit=20',
      '/api/activities?limit=10'
    ];
    
    await Promise.allSettled(
      endpoints.map(endpoint => fetch(endpoint))
    );
  }

  private async warmupCategories(): Promise<void> {
    const endpoints = [
      '/api/categories/activity',
      '/api/categories/content'
    ];
    
    await Promise.allSettled(
      endpoints.map(endpoint => fetch(endpoint))
    );
  }

  private async warmupUserData(): Promise<void> {
    // é¢„çƒ­ç”¨æˆ·ç›¸å…³çš„å¸¸ç”¨æ•°æ®
    // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´
  }
}
```

### 3.2 é›†æˆåˆ°åº”ç”¨å¯åŠ¨
```typescript
// src/App.tsx - æ·»åŠ ç¼“å­˜é¢„çƒ­
import { CacheWarmupService } from './services/cacheWarmupService';

function App() {
  useEffect(() => {
    // åº”ç”¨å¯åŠ¨åé¢„çƒ­ç¼“å­˜
    if (process.env.NODE_ENV === 'production') {
      CacheWarmupService.getInstance().warmupCriticalData();
    }
  }, []);

  // ... å…¶ä»–ä»£ç 
}
```

**é¢„æœŸæ•ˆæœ**: æå‡é¦–æ¬¡è®¿é—®æ€§èƒ½ 20-30%ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ

---

## ğŸ¯ ä»»åŠ¡4: ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ç›‘æ§ (1å¤©)

### 4.1 åˆ›å»ºç”Ÿäº§ç¯å¢ƒç›‘æ§ä¸­é—´ä»¶
```typescript
// api/middleware/performanceMonitor.ts
export const productionPerformanceMonitor = (req: Request, res: Response, next: NextFunction) => {
  const start = Date.now();
  const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  
  // æ·»åŠ è¯·æ±‚IDåˆ°å“åº”å¤´
  res.setHeader('X-Request-ID', requestId);
  
  // ç›‘æ§è¯·æ±‚å®Œæˆ
  res.on('finish', () => {
    const duration = Date.now() - start;
    const status = res.statusCode;
    
    // è®°å½•æ…¢è¯·æ±‚
    if (duration > 1000) {
      console.warn(`ğŸŒ æ…¢è¯·æ±‚ [${requestId}]: ${req.method} ${req.url} - ${duration}ms (${status})`);
      
      // å¯ä»¥å‘é€åˆ°ç›‘æ§æœåŠ¡
      this.sendToMonitoring({
        type: 'slow_request',
        requestId,
        method: req.method,
        url: req.url,
        duration,
        status,
        timestamp: new Date().toISOString()
      });
    }
    
    // è®°å½•é”™è¯¯è¯·æ±‚
    if (status >= 400) {
      console.error(`âŒ é”™è¯¯è¯·æ±‚ [${requestId}]: ${req.method} ${req.url} - ${status} (${duration}ms)`);
    }
  });
  
  next();
};
```

### 4.2 é›†æˆåˆ°ä¸»åº”ç”¨
```typescript
// api/app.ts - æ·»åŠ ç”Ÿäº§ç¯å¢ƒç›‘æ§
import { productionPerformanceMonitor } from './middleware/performanceMonitor.js';

// åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨æ€§èƒ½ç›‘æ§
if (process.env.NODE_ENV === 'production') {
  app.use(productionPerformanceMonitor);
}
```

**é¢„æœŸæ•ˆæœ**: å®æ—¶ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜

---

## ğŸ¯ ä»»åŠ¡5: å›¾ç‰‡ä¼˜åŒ–å¢å¼º (0.5å¤©)

### 5.1 æ·»åŠ å“åº”å¼å›¾ç‰‡æ”¯æŒ
```typescript
// src/components/LazyImage.tsx - å¢å¼ºå“åº”å¼æ”¯æŒ
interface LazyImageProps {
  src: string;
  alt: string;
  className?: string;
  sizes?: string; // æ–°å¢: å“åº”å¼å°ºå¯¸
  srcSet?: string; // æ–°å¢: å“åº”å¼å›¾ç‰‡é›†
}

const LazyImage: React.FC<LazyImageProps> = React.memo(({
  src,
  alt,
  className,
  sizes = '100vw',
  srcSet
}) => {
  return (
    <img
      src={src}
      alt={alt}
      className={className}
      sizes={sizes}
      srcSet={srcSet}
      loading="lazy"
    />
  );
});
```

### 5.2 ä¼˜åŒ–å›¾ç‰‡åŠ è½½ç­–ç•¥
```typescript
// åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨å“åº”å¼å›¾ç‰‡
<LazyImage
  src={imageUrl}
  alt={altText}
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
  srcSet={`
    ${imageUrl}?w=400 400w,
    ${imageUrl}?w=800 800w,
    ${imageUrl}?w=1200 1200w
  `}
/>
```

**é¢„æœŸæ•ˆæœ**: æå‡å›¾ç‰‡åŠ è½½æ€§èƒ½ 10-15%ï¼Œå‡å°‘å¸¦å®½æµªè´¹

---

## ğŸ¯ ä»»åŠ¡6: æ„å»ºä¼˜åŒ–å¢å¼º (0.5å¤©)

### 6.1 ä¼˜åŒ– Vite é…ç½®
```typescript
// vite.config.ts - å¢å¼ºæ„å»ºä¼˜åŒ–
export default defineConfig({
  build: {
    // ç°æœ‰é…ç½®...
    
    // æ–°å¢: æ›´ç²¾ç»†çš„ä»£ç åˆ†å‰²
    rollupOptions: {
      output: {
        manualChunks: {
          // ç°æœ‰é…ç½®...
          
          // æ–°å¢: æ›´ç»†ç²’åº¦çš„åˆ†å‰²
          'react-core': ['react', 'react-dom'],
          'react-router': ['react-router-dom'],
          'ui-components': ['lucide-react', 'clsx', 'tailwind-merge'],
          'state-management': ['zustand'],
          'i18n-core': ['i18next', 'react-i18next'],
          'i18n-detector': ['i18next-browser-languagedetector'],
          'supabase-core': ['@supabase/supabase-js'],
          'utils': ['date-fns']
        }
      }
    },
    
    // æ–°å¢: æ›´æ¿€è¿›çš„å‹ç¼©
    terserOptions: {
      compress: {
        // ç°æœ‰é…ç½®...
        drop_console: true,
        drop_debugger: true,
        pure_funcs: ['console.log', 'console.info', 'console.debug'],
        // æ–°å¢: ç§»é™¤æœªä½¿ç”¨çš„ä»£ç 
        unused: true,
        dead_code: true
      }
    }
  }
});
```

### 6.2 æ·»åŠ æ„å»ºåˆ†æ
```typescript
// æ·»åŠ æ„å»ºå¤§å°åˆ†æ
build: {
  // ç°æœ‰é…ç½®...
  
  // æ–°å¢: æ„å»ºå¤§å°è­¦å‘Š
  chunkSizeWarningLimit: 500, // é™ä½è­¦å‘Šé˜ˆå€¼
  
  // æ–°å¢: æ„å»ºæŠ¥å‘Š
  reportCompressedSize: true,
  rollupOptions: {
    output: {
      // ç°æœ‰é…ç½®...
      
      // æ–°å¢: æ›´è¯¦ç»†çš„æ„å»ºä¿¡æ¯
      assetFileNames: (assetInfo) => {
        const info = assetInfo.name.split('.');
        const ext = info[info.length - 1];
        if (/png|jpe?g|svg|gif|tiff|bmp|ico/i.test(ext)) {
          return `assets/images/[name]-[hash][extname]`;
        }
        if (/css/i.test(ext)) {
          return `assets/css/[name]-[hash][extname]`;
        }
        return `assets/[name]-[hash][extname]`;
      }
    }
  }
}
```

**é¢„æœŸæ•ˆæœ**: è¿›ä¸€æ­¥ä¼˜åŒ–åŒ…å¤§å° 5-8%ï¼Œæå‡åŠ è½½æ€§èƒ½

---

## ğŸ“Š å®æ–½æ—¶é—´è¡¨

### ç¬¬1å¤©: åŒ…åˆ†æå·¥å…· + ä¾èµ–ä¼˜åŒ–
- ä¸Šåˆ: é›†æˆåŒ…åˆ†æå·¥å…·
- ä¸‹åˆ: åˆ†æå¹¶ä¼˜åŒ–ä¾èµ–æ ‘

### ç¬¬2å¤©: ç¼“å­˜é¢„çƒ­ + æ€§èƒ½ç›‘æ§
- ä¸Šåˆ: å®ç°ç¼“å­˜é¢„çƒ­æœºåˆ¶
- ä¸‹åˆ: æ·»åŠ ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ç›‘æ§

### ç¬¬3å¤©: å›¾ç‰‡ä¼˜åŒ– + æ„å»ºå¢å¼º
- ä¸Šåˆ: å¢å¼ºå›¾ç‰‡å“åº”å¼æ”¯æŒ
- ä¸‹åˆ: ä¼˜åŒ– Vite æ„å»ºé…ç½®

---

## ğŸ¯ é¢„æœŸæ€»æ”¶ç›Š

å®Œæˆè¿™20%çš„ä¼˜åŒ–åï¼Œé¡¹ç›®å°†å®ç°ï¼š

### æ€§èƒ½æå‡
- **åŒ…å¤§å°**: å†å‡å°‘ 15-25%
- **é¦–å±åŠ è½½**: å†æå‡ 10-20%
- **å›¾ç‰‡åŠ è½½**: å†æå‡ 10-15%
- **æ•´ä½“æ€§èƒ½**: åŸºç¡€ä¼˜åŒ– + å‰©ä½™ä¼˜åŒ– = 85-95% æå‡

### ç”¨æˆ·ä½“éªŒ
- **é¦–æ¬¡è®¿é—®**: ç¼“å­˜é¢„çƒ­æ˜¾è‘—æ”¹å–„
- **æŒç»­ä½¿ç”¨**: æ€§èƒ½ç›‘æ§ä¿éšœç¨³å®šæ€§
- **å“åº”é€Ÿåº¦**: æ•´ä½“å“åº”æ—¶é—´å‡å°‘ 80-90%

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹**: è¿™20%çš„ä¼˜åŒ–å¯ä»¥åœ¨3å¤©å†…å®Œæˆï¼Œå®Œæˆåé¡¹ç›®å°†å…·å¤‡ï¼š
1. å®Œæ•´çš„æ€§èƒ½ç›‘æ§ä½“ç³»
2. æ™ºèƒ½çš„ç¼“å­˜é¢„çƒ­æœºåˆ¶
3. æœ€ä¼˜åŒ–çš„æ„å»ºé…ç½®
4. å“åº”å¼çš„å›¾ç‰‡åŠ è½½

**ç„¶åå¼€å§‹**: Redis ç¼“å­˜æ–¹æ¡ˆå®æ–½ï¼ŒåŸºç¡€ä¼˜åŒ– + ç¼“å­˜ = åŒé‡æ€§èƒ½æå‡ï¼

**æœ€ç»ˆç›®æ ‡**: æ•´ä½“æ€§èƒ½æå‡ 90-95%ï¼Œç”¨æˆ·ä½“éªŒè¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†ï¼
